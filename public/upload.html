<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Upload Notes ‚Äì StudyHub LUANAR</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; }
  body, html {
    margin: 0; padding: 0; height: 100%;
    font-family: 'Poppins', sans-serif;
    background: url('https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=1350&q=80') no-repeat center center fixed;
    background-size: cover;
    display: flex; justify-content: center; align-items: center;
    color: #fff;
    overflow: hidden;
  }
  .container {
    background: rgba(5, 5, 5, 0.322);
    backdrop-filter: blur(16px);
    border-radius: 24px;
    box-shadow: 0 12px 36px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.2);
    padding: 50px 35px;
    max-width: 420px;
    width: 90%;
    text-align: center;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }
  .container:hover {
    transform: translateY(-5px);
    box-shadow: 0 16px 48px rgba(0,0,0,0.55), inset 0 1px 0 rgba(255,255,255,0.2);
  }
  h2 {
    text-align: center;
    position: relative;
    display: inline-block;
    font-weight: bold;
    margin: 10px auto;
    padding: 8px 20px;
    color: black;
    font-size: 1rem; 
    border-radius: 10px;
    overflow: hidden;
    z-index: 0;
  }
  h2::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -100%;
    width: 200%;
    height: 200%;
    background: conic-gradient(from 0deg, #00ffff, #0044ff, #00ffff);
    animation: spin 5s linear infinite;
    z-index: -2;
  }
  h2::after {
    content: '';
    position: absolute;
    inset: 3px;
    background: aliceblue;
    border-radius: 8px;
    z-index: -1;
  }
  @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

  label {
    display: block;
    text-align: left;
    margin-top: 15px;
    font-weight: 400;
    color: #ffffff;
    text-shadow: 0 1px 3px rgba(0,0,0,0.5);
  }
  input, select {
    width: 100%; padding: 14px 16px; margin-top: 5px; border-radius: 14px; border: none;
    font-size: 1rem; outline: none; background: rgba(255 255 255 / 0.9); color: #333;
    box-shadow: inset 0 2px 6px rgba(0,0,0,0.1);
    transition: box-shadow 0.3s ease, transform 0.2s ease;
  }
  input:focus, select:focus {
    box-shadow: 0 0 12px 2px #ff813f;
    transform: scale(1.02);
  }
  .icon-button-container {
    display: inline-block;
    margin: 15px 10px;
    text-align: center;
  }
  .icon-button {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    border: none;
    background: linear-gradient(135deg, #0015cf, #8133e6);
    color: white;
    font-size: 1.5rem;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(255,129,63,0.6);
    transition: all 0.3s ease;
  }
  .icon-button:hover { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(255,129,63,0.7); }
  .icon-button:active { transform: translateY(0); box-shadow: 0 4px 12px rgba(255,129,63,0.6); }
  .back-btn {
    background: linear-gradient(135deg, #078818, #209204);
  }
  .back-btn:hover {
    background: linear-gradient(135deg, #27ae60, #1e8449);
    box-shadow: 0 8px 20px rgba(30,132,73,0.7);
  }
  .icon-button-label {
    display: block;
    margin-top: 6px;
    font-size: 0.9rem;
    font-weight: 600;
    color: #fff;
    text-shadow: 0 1px 3px rgba(0,0,0,0.5);
  }
  #progressContainer {
    margin-top: 20px;
    height: 18px;
    width: 100%;
    background: rgba(255,255,255,0.2);
    border-radius: 12px;
    overflow: hidden;
    display: none;
    box-shadow: inset 0 1px 3px rgba(0,0,0,0.2);
  }
  #progressBar {
    height: 100%;
    width: 0%;
    border-radius: 12px;
    background: linear-gradient(270deg, #6cff3f, #16ff29, #2bff00);
    background-size: 600% 100%;
    box-shadow: 0 0 8px rgba(255,129,63,0.6);
    transition: width 0.4s ease;
    animation: gradientMove 2s linear infinite;
  }
  @keyframes gradientMove {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }
  .message {
    margin-top: 12px;
    font-weight: 600;
    min-height: 1.4em;
    opacity: 0;
    transition: opacity 0.5s ease;
  }
  .message.show { opacity: 1; }
  .message.success { color: #2ecc71; text-shadow: 0 1px 3px rgba(0,0,0,0.3);}
  .message.error { color: #e74c3c; text-shadow: 0 1px 3px rgba(0,0,0,0.3);}
</style>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-0LTZS1S9W6"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() { dataLayer.push(arguments); }
  gtag('js', new Date());
  gtag('config', 'G-0LTZS1S9W6');
</script>

</head>
<body>
<div class="container">
  <h2>Upload Notes</h2>

  <form id="uploadForm" enctype="multipart/form-data">
    <label for="program">Program Name (Diploma / Bachelors / Masters / Basics):</label>
    <input type="text" id="program" name="program" required placeholder="e.g., Diploma in Agriculture" />

    <label for="semester">Semester (1-12):</label>
    <input type="number" id="semester" name="semester" min="1" max="12" required placeholder="e.g., 1 or 2" />

    <label for="subject">Subject:</label>
    <input type="text" id="subject" name="subject" required placeholder="e.g., Biology, Physics" />

    <label for="email">Email (optional):</label>
    <input type="email" id="email" name="email" placeholder="Enter your email (optional)" />

    <label for="file">Choose File (.pdf or .pptx):</label>
    <input type="file" id="file" name="file" accept=".pdf,.pptx" required />

    <div class="icon-button-container">
      <button class="icon-button" type="submit">üì§</button>
      <span class="icon-button-label">Upload</span>
    </div>

    <div class="icon-button-container">
      <button class="icon-button back-btn" type="button" onclick="window.location.href='index.html'">üè†</button>
      <span class="icon-button-label">Home</span>
    </div>

    <div id="progressContainer"><div id="progressBar"></div></div>
    <div class="message" id="uploadMessage" aria-live="polite"></div>
  </form>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAtK_FW9fIOihmnECEngkElA2QCsoRYUA0",
    authDomain: "studyhub-backend.firebaseapp.com",
    projectId: "studyhub-backend",
  };
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);

  // Check login
  onAuthStateChanged(auth, (user) => {
    if (!user) {
      alert("Please log in first before uploading files.");
      window.location.href = "login.html";
    }
  });

  const form = document.getElementById("uploadForm");
  const progressContainer = document.getElementById("progressContainer");
  const progressBar = document.getElementById("progressBar");
  const messageBox = document.getElementById("uploadMessage");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    // Program validation
    const programInput = document.getElementById("program").value.trim();
    const validPrograms = ["Diploma", "Bachelors", "Masters", "Basics"];
    if (!validPrograms.some(p => programInput.startsWith(p))) {
      alert("Program name must start with Diploma, Bachelors, Masters, or Basics.");
      return;
    }

    // Semester validation
    const semesterInput = document.getElementById("semester").value;
    if (!semesterInput || semesterInput < 1 || semesterInput > 12) {
      alert("Semester must be between 1 and 12.");
      return;
    }

    // File validation
    const file = document.getElementById("file").files[0];
    if (!file) return alert("Please choose a file first.");
    const allowedTypes = [
      "application/pdf",
      "application/vnd.openxmlformats-officedocument.presentationml.presentation"
    ];
    if (!allowedTypes.includes(file.type)) {
      alert("Only PDF or PPTX files are allowed!");
      return;
    }

    try {
      if (!auth.currentUser) {
        alert("User not logged in");
        return;
      }

      const token = await auth.currentUser.getIdToken();
      const formData = new FormData(form);
      const xhr = new XMLHttpRequest();
      xhr.open("POST", "/upload");
      xhr.setRequestHeader("Authorization", "Bearer " + token);

      progressContainer.style.display = "block";
      xhr.upload.addEventListener("progress", (event) => {
        if (event.lengthComputable) {
          const percent = Math.round((event.loaded / event.total) * 100);
          progressBar.style.width = percent + "%";
        }
      });

      xhr.onload = () => {
        if (xhr.status === 200) {
          messageBox.textContent = "‚úÖ Upload successful!";
          messageBox.className = "message success show";
          form.reset();
          setTimeout(() => progressContainer.style.display = "none", 1500);
          progressBar.style.width = "0%";
        } else {
          messageBox.textContent = "‚ùå Upload failed: " + xhr.responseText;
          messageBox.className = "message error show";
        }
      };

      xhr.onerror = () => {
        messageBox.textContent = "‚ùå Upload error. Please try again.";
        messageBox.className = "message error show";
      };

      xhr.send(formData);

    } catch (error) {
      console.error(error);
      messageBox.textContent = "‚ùå Upload error. Try again.";
      messageBox.className = "message error show";
    }
  });
</script>
</body>
</html>
