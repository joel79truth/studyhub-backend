<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Upload Notes ‚Äì StudyHub LUANAR</title>
<style>
  *, *::before, *::after { box-sizing: border-box; }
  body, html {
    margin: 0; padding: 0; height: 100%;
    font-family: 'Segoe UI', sans-serif;
    background: url('https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=1350&q=80') no-repeat center center fixed;
    background-size: cover;
    display: flex; justify-content: center; align-items: center;
    color: #fff;
  }
  .container {
    background: rgba(255 255 255 / 0.15);
    backdrop-filter: blur(12px);
    border-radius: 20px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.37);
    padding: 40px 30px;
    max-width: 420px;
    width: 90%;
    text-align: center;
  }
  h2 {
    margin-bottom: 25px;
    font-weight: 700;
    font-size: 2rem;
    color: #0a0a0a;
    text-shadow: 0 2px 6px rgba(0,0,0,0.7);
  }
  input, select {
    width: 100%; padding: 12px 15px; margin: 12px 0; border-radius: 10px; border: none;
    font-size: 1rem; outline: none; background: rgba(255 255 255 / 0.85); color: #333;
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.1); transition: box-shadow 0.3s ease;
  }
  input:focus, select:focus { box-shadow: 0 0 8px 2px #ff813f; background: white; }
  button {
    width: 100%; padding: 14px; margin-top: 18px; border: none; border-radius: 12px;
    background: linear-gradient(135deg, #ff813f, #e67333); color: white; font-size: 1.1rem;
    font-weight: 600; cursor: pointer; box-shadow: 0 6px 16px rgba(255, 129, 63, 0.7);
    transition: background 0.3s ease, box-shadow 0.3s ease;
  }
  button:hover, button:focus { background: linear-gradient(135deg, #e67333, #cc5e19); box-shadow: 0 8px 24px rgba(204, 94, 25, 0.85); outline: none; }
  .back-btn {
    background: linear-gradient(135deg, #2ecc71, #27ae60); margin-top: 12px;
    box-shadow: 0 6px 16px rgba(39, 174, 96, 0.7);
  }
  .back-btn:hover, .back-btn:focus { background: linear-gradient(135deg, #27ae60, #1e8449); box-shadow: 0 8px 24px rgba(30, 132, 73, 0.85); outline: none; }
  .message {
    margin-top: 12px;
    font-weight: 600;
    min-height: 1.2em;
  }
  .message.success { color: #2ecc71; }
  .message.error { color: #e74c3c; }

  #progressBar {
    height: 100%;
    width: 0%;
    border-radius: 12px;
    background: linear-gradient(270deg, #ff813f, #e67333, #ffca3a, #ff813f);
    background-size: 600% 100%;
    animation: gradientMove 2s linear infinite;
    transition: width 0.2s ease;
  }
  @keyframes gradientMove {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }
</style>
</head>
<body>
<div class="container" role="main" aria-labelledby="uploadHeading">
  <h2 id="uploadHeading">üìö Upload Notes</h2>
  <form id="uploadForm" enctype="multipart/form-data">
    <label for="program">Program Name (or "Basics"):</label>
    <input type="text" id="program" name="program" required placeholder="e.g., Agriculture or Basics" />

    <label for="semester">Semester (1-12) <span style="color:#ffca3a;">(optional)</span>:</label>
    <input type="number" min="1" max="12" id="semester" name="semester" placeholder="e.g., 1 or 2" />

    <label for="subject">Subject:</label>
    <input type="text" id="subject" name="subject" required placeholder="e.g., Biology, Physics" />

    <label for="file">Choose File (.pdf or .pptx):</label>
    <input type="file" id="file" name="file" accept=".pdf,.pptx" required />

    <button type="submit">Upload</button>

    <div id="progressContainer" style="margin-top: 15px; height: 20px; width: 100%; background: rgba(255,255,255,0.3); border-radius: 12px; overflow: hidden; display:none;">
      <div id="progressBar"></div>
    </div>

    <div class="message" id="uploadMessage" aria-live="polite"></div>
  </form>

  <button class="back-btn" onclick="window.location.href='index.html'" aria-label="Back to Home">üè† Back to Home</button>
</div>

<script>
const form = document.getElementById("uploadForm");
const messageEl = document.getElementById("uploadMessage");

form.addEventListener("submit", (e) => {
  e.preventDefault();

  const program = document.getElementById("program").value.trim();
  const semester = document.getElementById("semester").value.trim();
  const subject = document.getElementById("subject").value.trim();
  const fileInput = document.getElementById("file");

  messageEl.textContent = "";
  messageEl.className = "message";

  // Only check required fields: Program, Subject, File
  if (!fileInput.files.length || !program || !subject) {
    messageEl.textContent = "‚ö†Ô∏è Program, Subject, and File are required.";
    messageEl.classList.add("error");
    return;
  }

  // Store semester as "N/A" if empty
  const semesterValue = semester === "" ? "N/A" : semester;

  const formData = new FormData();
  formData.append("program", program);
  formData.append("semester", semesterValue);
  formData.append("subject", subject);
  formData.append("file", fileInput.files[0]);

  const progressContainer = document.getElementById("progressContainer");
  const progressBar = document.getElementById("progressBar");
  progressContainer.style.display = "block";
  progressBar.style.width = "0%";

  const xhr = new XMLHttpRequest();
  xhr.open("POST", "/upload");

  xhr.upload.addEventListener("progress", (event) => {
    if (event.lengthComputable) {
      const percent = Math.round((event.loaded / event.total) * 100);
      progressBar.style.width = percent + "%";
    }
  });

  xhr.onload = () => {
    if (xhr.status === 200) {
      messageEl.textContent = "‚úÖ Upload successful!";
      messageEl.classList.add("success");
      form.reset();
      progressBar.style.width = "100%";
      setTimeout(() => { progressContainer.style.display = "none"; progressBar.style.width = "0%"; }, 1000);
    } else {
      let res = {};
      try { res = JSON.parse(xhr.responseText); } catch {}
      messageEl.textContent = "‚ùå Upload failed: " + (res.message || "Server error");
      messageEl.classList.add("error");
      progressContainer.style.display = "none";
      progressBar.style.width = "0%";
    }
  };

  xhr.onerror = () => {
    messageEl.textContent = "‚ùå An error occurred during upload.";
    messageEl.classList.add("error");
    progressContainer.style.display = "none";
    progressBar.style.width = "0%";
  };

  xhr.send(formData);
});
</script>
</body>
</html>
