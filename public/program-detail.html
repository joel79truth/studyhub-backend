<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Program Details ‚Äì StudyHub LUANAR</title>
<link rel="stylesheet" href="style.css">
<style>
body { font-family:'Segoe UI',sans-serif; margin:0; padding:0; background:url('https://images.pexels.com/photos/6216870/pexels-photo-6216870.jpeg?auto=compress&cs=tinysrgb&dpr=3&h=750&w=1260') no-repeat center center fixed; background-size:cover; }
header { text-align:center; padding:20px; background: rgba(15,172,23,0.8); color:white; box-shadow:0 4px 8px rgba(0,0,0,0.2); }
h1 { margin:0; font-size:2rem; }
.container { max-width:900px; margin:20px auto; padding:0 20px; }
.search-bar { width:300px; margin:20px auto; }
.search-bar input { width:100%; padding:10px 15px; border-radius:50px; border:none; outline:none; font-size:14px; background: rgba(255,255,255,0.9); color:#1e1e1e; box-shadow:0 6px 15px rgba(0,0,0,0.2); }
#fileList { margin-top:20px; display:grid; grid-template-columns:repeat(auto-fill,minmax(250px,1fr)); gap:20px; }
.file-card { background:white; border-radius:15px; padding:20px; box-shadow:0 8px 25px rgba(0,0,0,0.15); text-align:center; }
.file-card h3 { margin:0 0 10px 0; font-size:1.1rem; color:#1e1e1e; }
.file-card p { font-size:0.9rem; color:#555; margin:5px 0; }
.file-card button { margin:5px; padding:8px 14px; border:none; border-radius:8px; cursor:pointer; font-weight:600; transition: transform 0.2s ease; }
.view-btn { background:#3498db; color:white; }
.download-btn { background:#2ecc71; color:white; }
.file-card button:hover { transform:scale(1.05); }
.back-home-btn { position:fixed; top:20px; left:20px; display:flex; flex-direction:column; align-items:center; justify-content:center; width:55px; height:55px; background:#000; color:white; text-decoration:none; border-radius:50%; font-size:24px; box-shadow:0 6px 15px rgba(0,0,0,0.3); }
</style>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0LTZS1S9W6"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-0LTZS1S9W6');
</script>


</head>
<body>

<header><h1 id="programTitle">Program Details</h1></header>
<a href="program.html" class="back-home-btn" aria-label="Back to Programs">üè†</a>

<div>
  <div class="container">
  <!-- Action Buttons Row -->
  <div style="
    display:flex; 
    justify-content:center; 
    gap:20px; 
    margin-bottom:15px;
  ">
    <!-- Upload Button -->
    <div style="display:flex; flex-direction:column; align-items:center;">
      <a href="upload.html" style="
        width:40px;
        height:40px;
        background: linear-gradient(135deg,#4f46e5,#3b82f6);
        border-radius:50%;
        display:flex;
        justify-content:center;
        align-items:center;
        color:white;
        text-decoration:none;
        box-shadow:0 5px 12px rgba(0,0,0,0.3);
        transition: all 0.3s ease;
        font-size:18px;
      " title="Upload Notes">üì§</a>
      <span style="
        font-size:0.7rem;
        font-weight: bolder;
        color:#000;
        margin-top:4px;
        background: rgba(255,255,255,0.85);
        padding:2px 6px;
        border-radius:6px;
      ">Upload</span>
    </div>

    <!-- Request Button -->
    <div style="display:flex; flex-direction:column; align-items:center;">
      <a href="request.html" style="
        width:40px;
        height:40px;
        background: linear-gradient(135deg,#4f46e5,#3b82f6);
        border-radius:50%;
        display:flex;
        justify-content:center;
        align-items:center;
        color:white;
        text-decoration:none;
        box-shadow:0 5px 12px rgba(0,0,0,0.3);
        transition: all 0.3s ease;
        font-size:18px;
      " title="Request Notes">üì©</a>
      <span style="
        font-size:0.7rem;
        font-weight: bolder;
        color:#000;
        margin-top:4px;
        background: rgba(255,255,255,0.85);
        padding:2px 6px;
        border-radius:6px;
      ">Request</span>
    </div>

    <!-- Video Button -->
    <div style="display:flex; flex-direction:column; align-items:center;">
      <a href="videolesson.html" style="
        width:40px;
        height:40px;
        background: linear-gradient(135deg,#4f46e5,#3b82f6);
        border-radius:50%;
        display:flex;
        justify-content:center;
        align-items:center;
        color:white;
        text-decoration:none;
        box-shadow:0 5px 12px rgba(0,0,0,0.3);
        transition: all 0.3s ease;
        font-size:18px;
      " title="Video Lessons">‚ñ∂Ô∏è</a>
      <span style="
        font-size:0.7rem;
        font-weight: bolder;
        color:#000;
        margin-top:4px;
        background: rgba(255,255,255,0.85);
        padding:2px 6px;
        border-radius:6px;
      ">Video</span>
    </div>
  </div>

   
<div class="container">
  <div class="search-bar">
    <input type="text" id="fileSearch" placeholder="Search files by subject or name...">
  </div>
  <div id="fileList"></div>
</div>

<script>
const params = new URLSearchParams(window.location.search);
const programName = params.get("program");
document.getElementById("programTitle").textContent = programName || "Program Details";

let allFiles = [];

// Normalize string comparison
function equalsIgnoreCase(a,b) { return a?.toLowerCase() === b?.toLowerCase(); }

// Check if file exists on server
async function fileExists(url) {
  try {
    const res = await fetch(url, { method: 'HEAD' });
    return res.ok;
  } catch {
    return false;
  }
}

async function loadFiles() {
  try {
    const res = await fetch("/api/metadata");
    const metadata = await res.json();

    const files = Array.isArray(metadata.files) ? metadata.files : [];
    let validFiles = [];

    for (const f of files) {
      if (equalsIgnoreCase(f.program, programName) && f.url && await fileExists(f.url)) {
        validFiles.push(f);
      }
    }

    allFiles = validFiles;

    const container = document.getElementById("fileList");
    if (!allFiles.length) {
      container.innerHTML = "<p>No uploaded files exist for this program.</p>";
      return;
    }

    displayFiles(allFiles);
  } catch (err) {
    console.error(err);
    document.getElementById("fileList").innerHTML = "<p>Error loading files.</p>";
  }
}

function displayFiles(files) {
  const container = document.getElementById("fileList");
  container.innerHTML = files.map(f => `
    <div class="file-card">
      <h3>${f.name}</h3>
      <p><strong>Semester:</strong> ${f.semester}</p>
      <p><strong>Subject:</strong> ${f.subject}</p>
      <button class="view-btn" onclick="window.open('${f.url}', '_blank')">View</button>
      <button class="download-btn" onclick="downloadFile('${f.url}')">Download</button>
    </div>
  `).join('');
}

function downloadFile(url) {
  const link = document.createElement("a");
  link.href = url;
  link.download = url.split("/").pop();
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}

document.getElementById("fileSearch").addEventListener("input", function() {
  const query = this.value.toLowerCase();
  const filtered = allFiles.filter(f => f.name.toLowerCase().includes(query) || f.subject.toLowerCase().includes(query));
  displayFiles(filtered);
});

loadFiles();
</script>

</body>
</html>
