<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>StudyHub LUANAR</title>
  <link rel="stylesheet" href="style.css">

  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#1E90FF" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-title" content="StudyHub LUANAR" />
  <link rel="apple-touch-icon" href="icons/icon-192.png" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />



  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-0LTZS1S9W6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-0LTZS1S9W6');
  </script>

  <style>
    /* Sidebar */
    .sidebar {
      position: fixed;
      top: 0;
      left: 0;
      width: 250px;
      height: 100vh;
      background: linear-gradient(180deg, #817cd8, #0f1011);
      color: white;
      padding: 20px 15px;
      box-shadow: 3px 0 12px rgba(59, 130, 246, 0.6);
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      z-index: 999;
      transform: translateX(-260px);
      transition: transform 0.3s ease;
    }

    .sidebar.active { transform: translateX(0); }

    .close-btn {
      align-self: flex-end;
      background: transparent;
      border: none;
      font-size: 30px;
      color: white;
      cursor: pointer;
      margin-bottom: 15px;
      transition: color 0.3s ease;
    }

    .nav-list { list-style: none; padding: 0; margin: 0; flex-grow: 1; }
    .nav-list li + li { margin-top: 15px; }
    .nav-list a {
      color: white; text-decoration: none; font-size: 1.1rem;
      padding: 10px 12px; display: block; border-radius: 8px;
      transition: background-color 0.25s ease; user-select: none;
    }
    .nav-list a:hover, .nav-list a:focus { background-color: rgba(255 255 255 / 0.2); outline: none; }

    .dark-mode-btn {
      margin-top: 20px; background: rgba(255 255 255 / 0.15);
      border: none; padding: 12px 15px; font-size: 1.1rem; color: white;
      border-radius: 8px; cursor: pointer; transition: background-color 0.3s ease;
      user-select: none;
    }
    .dark-mode-btn:hover, .dark-mode-btn:focus { background: rgba(255 255 255 / 0.3); outline: none; }

    .luanar-logo { width: 75px; height: auto; display: block; margin: 20px auto; }
    .logo-container { text-align: center; }

    /* Glassmorphism buttons */
    .glass-btn-row {
      display: flex; justify-content: space-around; align-items: center;
      margin: 20px auto; padding: 3px; width: 90%; max-width: 600px;
      background: rgba(0, 0, 0, 0.938); backdrop-filter: blur(10px);
      border-radius: 20px; box-shadow: 0 8px 32px rgba(0,0,0,0.1);
    }
    .glass-button { display: flex; flex-direction: column; align-items: center; }
    .glass-button .icon-btn {
      width: 60px; height: 60px; border-radius: 15px; display: flex;
      justify-content: center; align-items: center;
      background: linear-gradient(135deg, #4f46e5, #3b82f6);
      box-shadow: 0 6px 12px rgba(59, 130, 246, 0.5);
      transition: all 0.3s ease; text-decoration: none;
    }
    .glass-button .icon-btn:hover {
      background: linear-gradient(135deg, #4338ca, #2563eb);
      box-shadow: 0 8px 16px rgba(37, 99, 235, 0.7);
      transform: scale(1.05);
    }
    .glass-button .btn-label { font-size: 13px; color: white; margin-top: 6px; font-weight: bolder; }

    /* Subjects and files */
    .subject-btn {
      margin: 5px; padding: 8px 14px; border: none;
      border-radius: 8px; background: linear-gradient(135deg, #4f46e5, #3b82f6);
      color: white; cursor: pointer; font-weight: bold; transition: transform 0.2s;
    }
    .subject-btn:hover { transform: scale(1.05); }

    .bottom-buttons { display: flex; justify-content: center; gap: 30px; margin-top: 20px; }
    .button-with-label { display: flex; flex-direction: column; align-items: center; }
    .icon-btn { background: linear-gradient(135deg, #4f46e5, #3b82f6); color: white; border: none;
      width: 50px; height: 50px; border-radius: 12px; cursor: pointer; display: flex;
      align-items: center; justify-content: center; box-shadow: 0 6px 12px rgba(59, 130, 246, 0.5);
      transition: background 0.3s ease, box-shadow 0.3s ease; text-decoration: none; }
    .icon-btn:hover { background: linear-gradient(135deg, #4338ca, #2563eb); box-shadow: 0 8px 16px rgba(37, 99, 235, 0.7);}
    .icon-btn:active { transform: scale(0.97); box-shadow: 0 4px 8px rgba(37, 99, 235, 0.6); }
    .btn-label { font-size: 13px; color: white; margin-top: 6px; user-select: none; }

    /* Search & Semester */
    .search-bar { display: flex; justify-content: center; margin: 20px 0; gap: 10px; }
    .semesters { display: flex; justify-content: center; gap: 10px; margin-bottom: 15px; }
    .semesters button { padding: 8px 16px; border: none; border-radius: 8px; background: #4f46e5; color: white; cursor: pointer; font-weight: bold; }
    .semesters button:hover { transform: scale(1.05); }

    /* Install & Notifications */
    #installBtn, #subscribeBtn {
      position: fixed; right: 20px; border: none; cursor: pointer; z-index: 10000;
    }
    #installBtn {
      bottom: 20px; background-color: #1E90FF; color: white; border-radius: 10px; padding: 14px 24px; font-size: 16px; font-weight: bold; box-shadow: 0 6px 12px rgba(30, 144, 255, 0.5);
      display: none;
    }
    #installBtn:hover { background-color: #0f6cd3; box-shadow: 0 8px 16px rgba(15, 108, 211, 0.7); }
    #installBtn:active { transform: scale(0.97); box-shadow: 0 4px 8px rgba(15, 108, 211, 0.6); }

    #subscribeBtn {
      bottom: 70px; background: linear-gradient(135deg, #4A90E2, #357ABD);
      color: white; padding: 10px 18px; border-radius: 25px; font-size: 14px; font-weight: 600; box-shadow: 0 3px 6px rgba(0,0,0,0.15);
      transition: all 0.3s ease-in-out;
    }
    #subscribeBtn:hover { background: linear-gradient(135deg, #5AA0F2, #4689D6); transform: scale(1.05);}
    #subscribeBtn:active { transform: scale(0.95);}

  #notifyBell {
    position: fixed;
    bottom: 20px;
    right: 20px;
    font-size: 30px;
    cursor: pointer;
    background: none;
    border: none;
    color: #ffcc00; /* gold color for bell */
    z-index: 9999;
  }
</style>

<button id="notifyBell">üîî</button>

<!-- OneSignal SDK -->
<script src="https://cdn.onesignal.com/sdks/OneSignalSDK.js" async=""></script>
<script>
window.onload = () => {
  const notifyBell = document.getElementById('notifyBell');

  // Initialize OneSignal
  OneSignal.push(function() {
    OneSignal.init({
      appId: "dc041d91-35cf-4daf-9955-a390afb8c506",
      notifyButton: { enable: false } // disable default OneSignal bell
    });
  });

  // Handle bell click
  notifyBell.addEventListener('click', async () => {
    const permission = await Notification.requestPermission();

    if (permission === "granted") {
      OneSignal.push(() => {
        OneSignal.registerForPushNotifications()
          .then(() => console.log("‚úÖ Notifications enabled!"))
          .catch(err => console.error("‚ùå OneSignal subscription failed:", err));
      });

      // Hide the bell after subscribing
      notifyBell.style.display = 'none';
      new Notification("Notifications enabled!");
    } else {
      alert("Permission denied. You can enable notifications later in your browser settings.");
    }
  });
};
</script>


</head>

<body>
  <header>
    <h1>StudyHub LUANAR</h1>
  </header>

  <div class="logo-container">
    <img src="images/luanar-logo.png" alt="LUANAR-Logo" class="luanar-logo">
  </div>

  <!-- Sidebar -->
  <button id="menuIcon" class="menu-btn">
    <div class="bar"></div><div class="bar"></div><div class="bar"></div>
  </button>

  <nav class="sidebar" id="sidebar">
    <button id="closeSidebarBtn" class="close-btn">&times;</button>
    <ul class="nav-list">
      <li><a href="index.html">üè† Home</a></li>
      <li><a href="upload.html">üì§ Upload Notes</a></li>
      <li><a href="request.html">üì© Request Notes</a></li>
      <li><a href="developer.html">üë§ About the Developer</a></li>
      <li><a href="admin.html">üõ†Ô∏è Admin Panel</a></li>
      <li><a href="support.html">‚òï Buy me coffee</a></li>
    </ul>
    <button id="toggleDarkMode" class="dark-mode-btn" aria-pressed="false">üåô Toggle Dark Mode</button>
  </nav>
<main>
  <!-- Glass Buttons -->
  <main class="container">
    <div class="glass-btn-row">
      <div class="glass-button">
        <a href="message.html" class="icon-btn">üí¨</a>
        <div class="btn-label">Message</div>
      </div>
      <div class="glass-button">
        <a href="program.html" class="icon-btn">üìö</a>
        <div class="btn-label">Program</div>
      </div>
      <div class="glass-button">
        <a href="ai.html" class="icon-btn">ü§ñ</a>
        <div class="btn-label">AI</div>
      </div>
    </div>

<!-- Search & Semester -->
<div class="search-bar">
  <input type="text" id="searchInput" placeholder="Search for notes...">
  <button onclick="handleSearch()">Search</button>
</div>

<div class="semesters">
  <button onclick="filterSemester('1')">Semester 1</button>
  <button onclick="filterSemester('2')">Semester 2</button>
</div>

<!-- Subjects Section -->
<div id="subjectsContainer" class="subject-section"></div>
<button id="closeSubjectBtn" style="display:none;margin-top:10px;">‚ùå Close Subjects</button>

<!-- Files Section -->
<div id="fileList" class="file-list"></div>

</main>
  <!-- Bottom Buttons -->
  <div class="bottom-buttons">
    <div class="button-with-label">
      <a href="feedback.html" class="icon-btn">üìù</a>
      <div class="btn-label">Feedback</div>
    </div>
    <div class="button-with-label">
      <a href="videolesson.html" class="icon-btn">‚ñ∂Ô∏è</a>
      <div class="btn-label">Video</div>
    </div>
    <div class="button-with-label">
      <a href="request.html" class="icon-btn">üì©</a>
      <div class="btn-label">Request</div>
    </div>
    <div class="button-with-label">
      <a href="wisdom.html" class="icon-btn">üí°</a>
      <div class="btn-label">Wisdom</div>
    </div>
  </div>

  <!-- PWA Install & Notifications -->
  <button id="installBtn">Install App</button>
 

  <script src="script.js"></script>


  <!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-messaging.js"></script>

<script>
  // Your web app's Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyDMGA6lbQw5ky1chyZYUJda7nPD6FZq-Z4",
    authDomain: "truth-chart.firebaseapp.com",
    projectId: "truth-chart",
    storageBucket: "truth-chart.appspot.com",
    messagingSenderId: "69225001860",  
    appId: "1:69225001860:web:0620e79ed8ddfad8bc63d1"
  };

  // Initialize Firebase
  const app = firebase.initializeApp(firebaseConfig);
  const messaging = firebase.messaging();
</script>

  

  <script>
  // Sidebar toggle
  const sidebar = document.getElementById('sidebar');
  const menuIcon = document.getElementById('menuIcon');
  const closeSidebarBtn = document.getElementById('closeSidebarBtn');
  menuIcon.addEventListener('click', () => sidebar.classList.add('active'));
  closeSidebarBtn.addEventListener('click', () => sidebar.classList.remove('active'));

 
  // PWA install
  let deferredPrompt;
  window.addEventListener('beforeinstallprompt', e => {
    e.preventDefault();
    deferredPrompt = e;
    document.getElementById('installBtn').style.display = 'inline-block';
  });
  document.getElementById('installBtn').addEventListener('click', () => {
    if (!deferredPrompt) return;
    deferredPrompt.prompt();
    deferredPrompt.userChoice.then(() => {
      deferredPrompt = null;
      document.getElementById('installBtn').style.display = 'none';
    });
  });

  // Load service worker
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
      navigator.serviceWorker.register("./service-worker.js")
        .then(reg => console.log("SW registered:", reg.scope))
        .catch(err => console.error("SW registration failed:", err));
    });
  }

  // Create HTML for each file
  function createFileCard(file) {
    return `<div style="margin:5px; padding:10px; border:1px solid #ccc; border-radius:8px;">
      <a href="${file.url}" target="_blank">${file.name}</a> - <b>${file.subject}</b>
    </div>`;
  }

  // Load metadata.json
  let metadata = [];
  async function loadMetadata() {
    try {
      const response = await fetch('metadata.json');
      if (!response.ok) throw new Error("HTTP error " + response.status);
      const data = await response.json();
      metadata = data.files;
      console.log("Metadata loaded:", metadata);
    } catch (err) {
      console.error("Failed to fetch metadata.json:", err);
      document.getElementById('subjectsContainer').innerHTML = '<p>Error loading subjects. Check console.</p>';
    }
  }
  loadMetadata();

  // Search notes
  async function handleSearch() {
    const query = document.getElementById('searchInput').value.toLowerCase().trim();
    const fileList = document.getElementById('fileList');
    if (!query) { fileList.innerHTML = '<p>Please enter a search keyword.</p>'; return; }

    const filtered = metadata.filter(file =>
      (file.name || '').toLowerCase().includes(query) ||
      (file.subject || '').toLowerCase().includes(query) ||
      (file.program || '').toLowerCase().includes(query)
    );
    fileList.innerHTML = filtered.length === 0 ? '<p>No matching notes found.</p>' : filtered.map(createFileCard).join('');
  }

  // Show files by subject
  async function handleSubjectClick(subject) {
    const fileList = document.getElementById('fileList');
    const filtered = metadata.filter(file => (file.subject || '').toLowerCase() === subject.toLowerCase());
    fileList.innerHTML = filtered.length === 0 ? '<p>No files found for this subject.</p>' : filtered.map(createFileCard).join('');
  }

  // Filter subjects by semester
  async function filterSemester(semesterNumber) {
    const subjectsContainer = document.getElementById('subjectsContainer');
    const closeSubjectBtn = document.getElementById('closeSubjectBtn');
    subjectsContainer.innerHTML = '';
    closeSubjectBtn.style.display = 'inline-block';

    const semesterFiles = metadata.filter(f => f.semester == semesterNumber);
    const subjects = [...new Set(semesterFiles.map(f => f.subject))];

    if (subjects.length === 0) {
      subjectsContainer.innerHTML = '<p>No subjects found for this semester.</p>';
      return;
    }

    subjects.forEach(subject => {
      const btn = document.createElement('button');
      btn.textContent = subject;
      btn.className = 'subject-btn';
      btn.onclick = () => handleSubjectClick(subject);
      subjectsContainer.appendChild(btn);
    });
  }

  // Close subjects
  document.getElementById('closeSubjectBtn').addEventListener('click', () => {
    document.getElementById('subjectsContainer').innerHTML = '';
    document.getElementById('closeSubjectBtn').style.display = 'none';
    document.getElementById('fileList').innerHTML = '';
  });
</script>

<!-- Notification Bell -->



</body>

</html>
