<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduApp - Modern Learning Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="styles/globals.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 dark:from-blue-950/20 dark:via-background dark:to-purple-950/20">
    
    <!-- Mobile Header -->
    <div class="lg:hidden" id="mobileHeader">
     <!-- Main Header Bar -->
<div class="flex items-center justify-between p-4 bg-card border-b border-border">
    <div class="flex items-center gap-3">
        <button id="menuToggle" class="p-2 hover:bg-accent rounded-md transition-colors">
            <svg id="menuIcon" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="4" x2="20" y1="6" y2="6"/>
                <line x1="4" x2="20" y1="12" y2="12"/>
                <line x1="4" x2="20" y1="18" y2="18"/>
            </svg>
            <svg id="closeIcon" class="w-5 h-5 hidden" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="m18 6-12 12"/>
                <path d="m6 6 12 12"/>
            </svg>
        </button>

    <div class="flex items-center gap-2">
  <div class="w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center overflow-hidden">
    <img src="/images/luanar7.png" alt="LUANAR Logo">

       
     
  
  </div>

  <h1 class="text-lg font-medium">
  <span class="text-black">StudyHub</span>
  <span class="text-green-800"> LUANAR</span>
</h1>

</div>
</div>

    <div class="flex items-center gap-2">
        <button id="searchToggle" class="p-2 hover:bg-accent rounded-md transition-colors">
            <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"/>
                <path d="m21 21-4.35-4.35"/>
            </svg>
        </button>

        <!-- Profile Button -->
       <!-- Profile Button -->
<!-- Profile Button -->
<div id="youButton" class="flex flex-col items-center cursor-pointer">
  <a href="profile.html">
    <img id="youProfilePic" src="https://cdn-icons-png.flaticon.com/512/847/847969.png"
      alt="Profile Picture" class="w-8 h-8 rounded-full border-2 border-blue-500 shadow-sm transition-transform duration-300 hover:scale-110">
  </a>
  <span class="text-xs font-semibold text-blue-400 mt-1">You</span>
</div>


    </div>
</div>

        <!-- Search Bar -->
        <div id="searchBar" class="hidden p-4 bg-card border-b border-border">
            <div class="relative">
                <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"/>
                    <path d="m21 21-4.35-4.35"/>
                </svg>
                <input 
                    type="text" 
                    placeholder="Search courses..." 
                    class="w-full pl-10 pr-4 py-2 bg-background/50 backdrop-blur-sm border border-border/50 rounded-lg focus:outline-none focus:ring-2 focus:ring-ring"
                >
            </div>
        </div>

        <!-- Welcome Section -->
       <div class="p-4 bg-gradient-to-br from-blue-50 to-purple-50 dark:from-blue-950/20 dark:to-purple-950/20">
    <div class="text-center space-y-2">
        <h2 id="welcomeName" class="text-xl font-medium">Welcome back!</h2>
        <p class="text-sm text-muted-foreground">Continue your learning journey</p>
    </div>
</div>

        </div>
    </div>

    <div class="flex h-screen lg:h-auto">
        <!-- Sidebar Overlay -->
        <div id="sidebarOverlay" class="lg:hidden fixed inset-0 bg-black/50 backdrop-blur-sm z-40 hidden"></div>
        
        <!-- Sidebar -->
        <div id="sidebar" class="fixed lg:static top-0 left-0 h-full w-64 bg-gradient-to-b from-blue-50 to-purple-50 dark:from-blue-950/20 dark:to-purple-950/20 border-r border-border/50 backdrop-blur-xl transform -translate-x-full lg:translate-x-0 transition-transform duration-300 ease-in-out z-50 flex flex-col">
            <!-- Mobile Close Button -->
            <div class="lg:hidden flex justify-end p-4">
                <button id="sidebarClose" class="p-2 hover:bg-white/50 dark:hover:bg-black/20 rounded-md transition-colors">
                    <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="m18 6-12 12"/>
                        <path d="m6 6 12 12"/>
                    </svg>
                </button>
            </div>

            <!-- Logo/Brand -->
            

            <!-- User Profile -->
          <!-- User Profile -->
<div class="px-6 pb-4">
    <div class="flex items-center gap-3 p-3 rounded-xl bg-white/50 dark:bg-black/20 backdrop-blur-sm border border-white/20 shadow-sm">
        <div id="sidebarInitials" class="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-medium ring-2 ring-white/30">
            JD
        </div>
        <div class="flex-1 min-w-0">
            <p id="sidebarFullName" class="text-sm font-medium truncate">John Doe</p>
            <p class="text-xs text-muted-foreground truncate">Student</p>
        </div>
    </div>
</div>


            <!-- Navigation -->
           <nav class="flex-1 px-6">
    <ul class="space-y-2">
        <li>
            <a href="upload.html" class="nav-link w-full flex items-center gap-3 px-3 py-2.5 rounded-xl bg-gradient-to-r from-blue-500 to-purple-600 text-white shadow-lg hover:from-blue-600 hover:to-purple-700 transition-all">
                <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                    <polyline points="9,22 9,12 15,12 15,22"/>
                </svg>
                Upload Notes
            </a>
        </li>
        <li>
            <a href="my_courses.html" class="nav-link w-full flex items-center gap-3 px-3 py-2.5 rounded-xl hover:bg-white/50 dark:hover:bg-black/20 hover:backdrop-blur-sm transition-all">
                <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
                    <path d="M6.5 2H20v20l-5.5-6-5.5 6V2Z"/>
                </svg>
                My Courses
            </a>
        </li>
        <li>
            <a href="timetable.html" class="nav-link w-full flex items-center gap-3 px-3 py-2.5 rounded-xl hover:bg-white/50 dark:hover:bg-black/20 hover:backdrop-blur-sm transition-all">
                <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                    <line x1="16" y1="2" x2="16" y2="6"/>
                    <line x1="8" y1="2" x2="8" y2="6"/>
                    <line x1="3" y1="10" x2="21" y2="10"/>
                </svg>
                Timetable
            </a>
        </li>
        <li>
            <a href="achievements.html" class="nav-link w-full flex items-center gap-3 px-3 py-2.5 rounded-xl hover:bg-white/50 dark:hover:bg-black/20 hover:backdrop-blur-sm transition-all">
                <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="8" r="7"/>
                    <polyline points="8.21,13.89 7,23 12,20 17,23 15.79,13.88"/>
                </svg>
                Achievements
            </a>
        </li>
        <li>
            <a href="profile.html" class="nav-link w-full flex items-center gap-3 px-3 py-2.5 rounded-xl hover:bg-white/50 dark:hover:bg-black/20 hover:backdrop-blur-sm transition-all">
                <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                    <circle cx="12" cy="7" r="4"/>
                </svg>
                Profile
            </a>
        </li>
        <li>
            <a href="settings.html" class="nav-link w-full flex items-center gap-3 px-3 py-2.5 rounded-xl hover:bg-white/50 dark:hover:bg-black/20 hover:backdrop-blur-sm transition-all">
                <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/>
                    <circle cx="12" cy="12" r="3"/>
                </svg>
                Settings
            </a>
        </li>
    </ul>
</nav>
 
            <!-- Footer -->
            <div class="p-6">
                <div class="h-px bg-border/30 mb-4"></div>
                <div class="text-xs text-muted-foreground text-center">
                    Â© 2024 EduApp. All rights reserved.
                </div>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="flex-1 overflow-hidden lg:ml-0">
            <div class="h-full overflow-y-auto">
                <div class="p-4 lg:p-8 space-y-6 lg:space-y-8">
                    <!-- Desktop Header -->
                    <div class="hidden lg:block space-y-6">
                        <div class="text-left space-y-2">
                            <h1 class="text-3xl font-medium bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
                                Welcome back, John!
                            </h1>
                            <p class="text-muted-foreground">
                                Continue your learning journey and achieve your goals ðŸš€
                            </p>
                        </div>

                        <div class="flex flex-col sm:flex-row items-start sm:items-center gap-4">
                            <div class="relative flex-1 max-w-md">
                                <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="11" cy="11" r="8"/>
                                    <path d="m21 21-4.35-4.35"/>
                                </svg>
                                <input 
                                    type="text" 
                                    placeholder="Search courses, instructors, or topics..." 
                                    class="w-full pl-10 pr-4 py-3 bg-background/50 backdrop-blur-sm border border-border/50 rounded-lg focus:outline-none focus:ring-2 focus:ring-ring"
                                >
                            </div>
                            
                            <div class="flex gap-2">
                                <button class="flex items-center gap-2 px-4 py-3 bg-background/50 backdrop-blur-sm border border-border/50 rounded-lg hover:bg-accent transition-all">
                                    <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polygon points="22,3 2,3 10,12.46 10,19 14,21 14,12.46"/>    
                                    </svg>
                                    Filter
                                </button>
                                
                                <button class="relative flex items-center gap-2 px-4 py-3 bg-background/50 backdrop-blur-sm border border-border/50 rounded-lg hover:bg-accent transition-all">
                                    <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/>
                                        <path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/>
                                    </svg>
                                    <span class="absolute -top-1 -right-1 w-4 h-4 bg-destructive text-destructive-foreground rounded-full flex items-center justify-center text-xs">3</span>
                                </button>
                            </div>
                        </div>
                    </div>
                      <!-- Glass Buttons -->
                        <div class="flex flex-col items-center gap-8">
                            <!-- Main Glass Buttons -->
<div class="flex items-center justify-around w-full max-w-xs p-2 bg-black/10 dark:bg-black/40 backdrop-blur-xl rounded-2xl border border-white/20">
  <!-- Past Papers -->
  <div class="glass-button flex flex-col items-center">
    <button id="btnPastPapers" class="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white shadow-lg border border-white/20 hover:scale-105 transition-transform">
      <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
      </svg>
    </button>
    <span class="text-xs font-medium mt-1.5">Past Papers</span>
  </div>

  <!-- Programs -->
  <div class="glass-button flex flex-col items-center">
    <button id="btnPrograms" class="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white shadow-lg border border-white/20 hover:scale-105 transition-transform">
      <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
        <path d="M6.5 2H20v20l-5.5-6-5.5 6V2Z"/>
      </svg>
    </button>
    <span class="text-xs font-medium mt-1.5">Programs</span>
  </div>

  <!-- AI Tutor -->
  <div class="glass-button flex flex-col items-center">
    <button id="btnAITutor" class="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white shadow-lg border border-white/20 hover:scale-105 transition-transform">
      <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="2" y="3" width="20" height="14" rx="2" ry="2"/>
        <line x1="8" y1="21" x2="16" y2="21"/>
        <line x1="12" y1="17" x2="12" y2="21"/>
      </svg>
    </button>
    <span class="text-xs font-medium mt-1.5">AI Tutor</span>
  </div>
</div>

                    <!-- Mobile Features -->
                    <div class="lg:hidden space-y-6" id="mobileFeatures">
                        <!-- Image Carousel -->
                        <div class="relative w-full h-48 rounded-2xl overflow-hidden shadow-xl">
                            <div class="carousel-container">
                                <div class="carousel-slide active">
                                    <img src="https://images.unsplash.com/photo-1523050854058-8df90110c9f1?w=600&h=400&fit=crop" alt="Students studying" class="w-full h-full object-cover">
                                </div>
                                <div class="carousel-slide">
                                    <img src="https://images.unsplash.com/photo-1571260899304-425eee4c7efc?w=600&h=400&fit=crop" alt="Online learning" class="w-full h-full object-cover">
                                </div>
                                <div class="carousel-slide">
                                    <img src="https://images.unsplash.com/photo-1434030216411-0b793f4b4173?w=600&h=400&fit=crop" alt="Education technology" class="w-full h-full object-cover">
                                </div>
                                <div class="carousel-slide">
                                    <img src="https://images.unsplash.com/photo-1522202176988-66273c2fd55f?w=600&h=400&fit=crop" alt="Group study" class="w-full h-full object-cover">
                                </div>
                                <div class="carousel-slide">
                                    <img src="https://images.unsplash.com/photo-1488190211105-8b0e65b80b4e?w=600&h=400&fit=crop" alt="Books and learning" class="w-full h-full object-cover">
                                </div>
                            </div>
                            
                            <!-- Carousel Indicators -->
                            <div class="absolute bottom-3 left-1/2 transform -translate-x-1/2 flex gap-2">
                                <button class="carousel-indicator active w-2 h-2 rounded-full bg-white" data-slide="0"></button>
                                <button class="carousel-indicator w-2 h-2 rounded-full bg-white/50" data-slide="1"></button>
                                <button class="carousel-indicator w-2 h-2 rounded-full bg-white/50" data-slide="2"></button>
                                <button class="carousel-indicator w-2 h-2 rounded-full bg-white/50" data-slide="3"></button>
                                <button class="carousel-indicator w-2 h-2 rounded-full bg-white/50" data-slide="4"></button>
                            </div>
                        </div>

                      
                          
                    <!-- Stats Cards -->
                   <!-- Stats Cards -->
<div class="grid grid-cols-2 lg:grid-cols-4 gap-3 lg:gap-6" id="statsCards">

  <!-- Courses Enrolled -->
  <div class="bg-background/50 backdrop-blur-sm border border-border/50 rounded-xl p-4 hover:shadow-lg transition-all duration-200 hover:-translate-y-1">
  <div class="flex items-center justify-between mb-2">
    <h3 class="text-xs lg:text-sm font-medium">Days Until Exams</h3>
    <div class="p-2 rounded-lg bg-gradient-to-br from-blue-500 to-cyan-500 shadow-lg">
      <svg class="h-4 w-4 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
        <path d="M6.5 2H20v20l-5.5-6-5.5 6V2Z"/>
      </svg>
    </div>
  </div>
  <div id="daysLeft" class="text-2xl font-bold">0</div>
  <p id="daysDelta" class="text-xs text-muted-foreground"></p>
</div>

 
  <!-- Learning Streak -->
  <div class="bg-background/50 backdrop-blur-sm border border-border/50 rounded-xl p-4 hover:shadow-lg transition-all duration-200 hover:-translate-y-1">
    <div class="flex items-center justify-between mb-2">
      <h3 class="text-xs lg:text-sm font-medium">Learning Streak</h3>
      <div class="p-2 rounded-lg bg-gradient-to-br from-orange-500 to-red-500 shadow-lg">
        <svg class="h-4 w-4 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="22,12 18,12 15,21 9,3 6,12 2,12"/>
        </svg>
      </div>
    </div>
    <div id="streakCount" class="text-2xl font-bold">0 days</div>
  </div>

</div>

                    <!-- Course Grid -->
                    <div class="space-y-8">
                        <!-- Continue Learning Section -->
                        <div>
                            <div class="flex items-center justify-between mb-6">
                                <h2 class="text-xl font-medium">Recently uploaded<h2>
                                <button class="text-sm font-medium text-blue-600 hover:text-blue-700">View All</button>
                            </div>
                            
                           <div id="courseGrid" class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                              <!-- Supabase files will be injected here -->
                             </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

   <script>



    
/* ===============================
   UI STATE
================================ */
let isSidebarOpen = false;
let isSearchOpen = false;
let currentSlide = 0;
let carouselInterval;

/* ===============================
   DOM ELEMENTS
================================ */
const menuToggle = document.getElementById("menuToggle");
const menuIcon = document.getElementById("menuIcon");
const closeIcon = document.getElementById("closeIcon");
const sidebar = document.getElementById("sidebar");
const sidebarOverlay = document.getElementById("sidebarOverlay");
const sidebarClose = document.getElementById("sidebarClose");
const searchToggle = document.getElementById("searchToggle");
const searchBar = document.getElementById("searchBar");

/* ===============================
   INIT
================================ */
document.addEventListener("DOMContentLoaded", () => {
  initSidebar();
  initSearch();
  initCarousel();
  initGlassButtons();
  initProgressBars();
});


 // Button click handlers
  document.getElementById("btnPastPapers").addEventListener("click", () => {
    // Example action: navigate to past papers page
    window.location.href = "/past-papers.html";
  });

  document.getElementById("btnPrograms").addEventListener("click", () => {
    // Example action: navigate to programs page
    window.location.href = "/program.html";
  });

  document.getElementById("btnAITutor").addEventListener("click", () => {
    // Example action: open AI tutor modal
    // Could also redirect: window.location.href = "/ai-tutor.html";
    alert("Launching AI Tutor... ðŸš€");
     window.location.href = "/ai-tutor.html";
  });


/* ===============================
   SIDEBAR
================================ */
function initSidebar() {
  menuToggle?.addEventListener("click", toggleSidebar);
  sidebarClose?.addEventListener("click", closeSidebar);
  sidebarOverlay?.addEventListener("click", closeSidebar);
}

function toggleSidebar() {
  isSidebarOpen = !isSidebarOpen;
  updateSidebar();
}

function closeSidebar() {
  isSidebarOpen = false;
  updateSidebar();
}

function updateSidebar() {
  sidebar.classList.toggle("-translate-x-full", !isSidebarOpen);
  sidebarOverlay.classList.toggle("hidden", !isSidebarOpen);
  menuIcon.classList.toggle("hidden", isSidebarOpen);
  closeIcon.classList.toggle("hidden", !isSidebarOpen);
  document.body.style.overflow = isSidebarOpen ? "hidden" : "";
}
const sidebarInitials = document.getElementById("sidebarInitials");
const sidebarFullName = document.getElementById("sidebarFullName");


/* ===============================
   SEARCH
================================ */
function initSearch() {
  searchToggle?.addEventListener("click", () => {
    isSearchOpen = !isSearchOpen;
    searchBar.classList.toggle("hidden", !isSearchOpen);
    searchBar.querySelector("input")?.focus();
  });
}

/* ===============================
   CAROUSEL
================================ */
function initCarousel() {
  const slides = document.querySelectorAll(".carousel-slide");
  if (!slides.length) return;
  startCarousel();
}

function startCarousel() {
  stopCarousel();
  carouselInterval = setInterval(() => {
    const slides = document.querySelectorAll(".carousel-slide");
    slides.forEach(s => s.classList.remove("active"));
    currentSlide = (currentSlide + 1) % slides.length;
    slides[currentSlide].classList.add("active");
  }, 4000);
}

function stopCarousel() {
  clearInterval(carouselInterval);
}

/* ===============================
   GLASS BUTTONS
================================ */
function initGlassButtons() {
  document.querySelectorAll(".glass-button button").forEach(btn => {
    btn.addEventListener("click", e => {
      e.preventDefault();
      const label = btn.innerText.toLowerCase();

      btn.style.transform = "scale(0.95)";
      setTimeout(() => (btn.style.transform = ""), 150);

      if (label.includes("past")) location.href = "past-papers.html";
      else if (label.includes("program")) location.href = "program.html";
      else if (label.includes("ai")) location.href = "ai-tutor.html";
    });
  });
}

/* ===============================
   PROGRESS BARS
================================ */
function initProgressBars() {
  document.querySelectorAll("[style*='width']").forEach(bar => {
    const w = bar.style.width;
    bar.style.width = "0%";
    setTimeout(() => (bar.style.width = w), 300);
  });
}


//profile picture toggle
const youProfilePic = document.getElementById("youProfilePic");

// Load cached picture on page load
const cachedPic = localStorage.getItem("userProfilePic");
if (cachedPic) youProfilePic.src = cachedPic;

// Update "You" button whenever the main profile picture changes
function updateYouButtonPic(newPic) {
  youProfilePic.src = newPic;
  localStorage.setItem("userProfilePic", newPic);
}

// Sync with your existing profilePic upload logic
profilePic.addEventListener("click", () => uploadInput.click());
changePicBtn.addEventListener("click", () => uploadInput.click());

uploadInput.addEventListener("change", function() {
  const file = this.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = function(e) {
      const newPhoto = e.target.result;
      profilePic.src = newPhoto;
      updateYouButtonPic(newPhoto); // <-- Update "You" button here
      if (auth.currentUser) updateProfile(auth.currentUser, { photoURL: newPhoto });
    };
    reader.readAsDataURL(file);
  }
});

</script>
<script type="module">
/* ===============================
   IMPORTS
================================ */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js";
import { getFirestore, doc, getDoc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";
import { getMessaging, getToken, onMessage } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-messaging.js";
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";


/* ===============================
   FIREBASE
================================ */
const firebaseConfig = {
  apiKey: "AIzaSyAtK_FW9fIOihmnECEngkElA2QCsoRYUA0",
  authDomain: "studyhub-backend.firebaseapp.com",
  projectId: "studyhub-backend",
  storageBucket: "studyhub-backend.firebasestorage.app",
  messagingSenderId: "985257842533",
  appId: "1:985257842533:web:7cc7c9c0f74cc100ad338c"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const messaging = getMessaging(app);    
// Handle user login and FCM token registration
let swRegistration;
let messageListenerAttached = false;

onAuthStateChanged(auth, async (user) => {
  if (!user) {
    alert("Please log in first before uploading files.");
    window.location.href = "login.html";
    return;
  }

  console.log("USER PROVIDER:", user.providerData);

  // Fill email
  const emailInput = document.getElementById("email");
  if (emailInput && user.email) {
    emailInput.value = user.email;
  }

  try {
    // Register SW ONCE
    if (!swRegistration) {
      swRegistration = await navigator.serviceWorker.register("/firebase-messaging-sw.js");
    }

    const permission = await Notification.requestPermission();
    if (permission !== "granted") {
      console.warn("Notifications denied");
      return;
    }

    const fcmToken = await getToken(messaging, {
      vapidKey: "BKolFxr4YYRukImWVT8_YPOgyrIDk0y0xPvIS-FIwH6adpzl9fr8bvhLmfie-5KUyONylN7u96fgz4pbyrT5q6A",
      serviceWorkerRegistration: swRegistration,
    });

    if (!fcmToken) return;

    // ðŸ” Prevent duplicate token saves
    const savedToken = localStorage.getItem("fcmToken");

    if (savedToken !== fcmToken) {
      const idToken = await user.getIdToken();

      await fetch("/save-token", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          Authorization: `Bearer ${idToken}`,
        },
        body: JSON.stringify({ token: fcmToken }),
      });

      localStorage.setItem("fcmToken", fcmToken);
      console.log("FCM token saved");
    } else {
      console.log("Same FCM token â€” not resending");
    }

    // Foreground notifications (safe)
    if (!messageListenerAttached) {
      onMessage(messaging, (payload) => {
        if (!payload.notification) return;

        new Notification(payload.notification.title || "StudyHub", {
          body: payload.notification.body || "New update",
          icon: "/icons/icon-192.png",
        });
      });

      messageListenerAttached = true;
    }

  } catch (err) {
    console.error("FCM setup failed:", err);
  }
});
/* ===============================
   SUPABASE
================================ */
const supabase = createClient(
  "https://qosudbigoxwzbdqkdecz.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFvc3VkYmlnb3h3emJkcWtkZWN6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3NDU3NDMsImV4cCI6MjA3MzMyMTc0M30.B4ITihJkyALUSahDgGNgta6tivR7siBy7wM8KKb6JVQ "
);

/* ===============================
   AUTH FLOW
================================ */
onAuthStateChanged(auth, async user => {
  if (!user) return;

  /* ---- USER PROGRAM ---- */
  const userSnap = await getDoc(doc(db, "users", user.uid));
  if (!userSnap.exists()) return console.error("No user profile");

  const program = userSnap.data().program;
  if (!program) return console.error("Program missing");
const welcomeName = document.getElementById("welcomeName");

onAuthStateChanged(auth, (user) => {
    if (user) {
        // Use displayName if set, otherwise fallback to email prefix
        const nameToShow = user.displayName || user.email.split("@")[0];
        welcomeName.textContent = `Welcome back, ${nameToShow}!`;
    } else {
        welcomeName.textContent = "Welcome back!";
    }
});
onAuthStateChanged(auth, (user) => {
    if (user) {
        // Full name
        const fullName = user.displayName || user.email.split("@")[0];
        sidebarFullName.textContent = fullName;

        // Initials
        const names = fullName.trim().split(" ");
        let initials = names.length === 1 ? names[0][0] : names[0][0] + names[names.length - 1][0];
        initials = initials.toUpperCase();
        sidebarInitials.textContent = initials;
    } else {
        sidebarFullName.textContent = "Guest";
        sidebarInitials.textContent = "G";
    }
});

  /* ---- STATS ---- */
  const statsRef = doc(db, "users", user.uid, "stats", "main");
  await setDoc(statsRef, { streak: 1 }, { merge: true });

  onSnapshot(statsRef, snap => {
    const d = snap.data();
    document.getElementById("streakCount").textContent = `${d?.streak ?? 0} days`;
  });
 // Set your end-of-semester exam date here (YYYY, M-1, D)
  const examDate = new Date(2026, 4, 10); // May 10, 2026
  const today = new Date();

  // Calculate difference in days
  const diffTime = examDate - today;
  const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

  // Update HTML
  const daysLeftEl = document.getElementById("daysLeft");
  const daysDeltaEl = document.getElementById("daysDelta");

  if (diffDays > 0) {
    daysLeftEl.textContent = diffDays;
    daysDeltaEl.textContent = "days left until exams";
  } else if (diffDays === 0) {
    daysLeftEl.textContent = "0";
    daysDeltaEl.textContent = "Exams start today!";
  } else {
    daysLeftEl.textContent = "0";
    daysDeltaEl.textContent = "Exams are over";
  }
  /* ---- FILES ---- */
 async function loadFiles(program) {
  try {
    const { data, error } = await supabase
      .from("files")
      .select("*")
      .ilike("program", `%${program.trim()}%`)  // case-insensitive match
      .order("uploaded_at", { ascending: false })
      .limit(6);

    console.log("Program:", program);
    console.log("Files:", data);
    console.log("Error:", error);

    if (error) {
      console.error("Supabase error:", error);
      return;
    }

    if (!data || data.length === 0) {
      console.warn("No files found for this program");
      return;
    }

    renderFiles(data);

  } catch (err) {
    console.error("loadFiles crashed:", err);
  }
}


  // Call loadFiles with the user's program
  loadFiles(program);

}); // <-- This closes the onAuthStateChanged callback


/* ===============================
   RENDER FILES
================================ */
/* ===============================
   RENDER FILES
================================ */
/* ===============================
   RENDER FILES (Useful metadata)
================================ */
/* ===============================
   RENDER FILES (Course and Semester instead of author/size)
================================ */
/* ===============================
   RENDER FILES (Subject and Semester)
================================ */
function renderFiles(files) {
  const grid = document.getElementById("courseGrid");
  grid.innerHTML = "";

  files.forEach(file => {
    // Determine which URL to use
    const fileUrl = file.url || (file.file_path 
      ? supabase.storage.from("notes").getPublicUrl(file.file_path).data.publicUrl
      : null);

    if (!fileUrl) {
      console.warn("Skipping file with missing URL:", file);
      return;
    }

    // ======= Useful metadata =======
    const title = file.title || file.filename || "Untitled File";
    const subject = file.subject || "Unknown Subject";    // previously author
    const semester = file.semester || "N/A";              // previously size/duration
    const category = file.category || "General";
    const downloads = file.downloads || 0;                // for progress bar
    const rating = file.rating ? file.rating.toFixed(1) : "N/A";

    // ======= Determine file type icon =======
    const lowerTitle = title.toLowerCase();
    let imageUrl;
    if (lowerTitle.endsWith(".pdf")) {
      imageUrl = "https://cdn-icons-png.flaticon.com/512/337/337946.png"; // PDF
    } else if (lowerTitle.endsWith(".doc") || lowerTitle.endsWith(".docx")) {
      imageUrl = "https://cdn-icons-png.flaticon.com/512/337/337932.png"; // Word
    } else if (lowerTitle.endsWith(".ppt") || lowerTitle.endsWith(".pptx")) {
      imageUrl = "https://cdn-icons-png.flaticon.com/512/337/337951.png"; // PowerPoint
    } else {
      imageUrl = `https://source.unsplash.com/400x300/?${encodeURIComponent(title)}`;
    }

    // ======= Render card =======
    grid.innerHTML += `
      <div class="bg-card border border-border rounded-xl overflow-hidden hover:shadow-lg transition-all duration-200 hover:-translate-y-1 group">
        <div class="relative h-48 overflow-hidden">
          <img src="${imageUrl}" 
               alt="${title}" 
               class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-200">
          <div class="absolute top-3 left-3">
            <span class="px-2 py-1 bg-background/90 backdrop-blur-sm text-xs font-medium rounded-md">
              ${category}
            </span>
          </div>
          <div class="absolute inset-0 bg-black/20 opacity-0 group-hover:opacity-100 transition-opacity duration-200 flex items-center justify-center">
            <div class="w-12 h-12 bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center">
              <svg class="w-6 h-6 text-white" viewBox="0 0 24 24" fill="currentColor">
                <polygon points="5,3 19,12 5,21"/>
              </svg>
            </div>
          </div>
        </div>

        <div class="p-4">
          <h3 class="font-medium mb-1 group-hover:text-blue-600 transition-colors line-clamp-2">${title}</h3>
          <p class="text-sm text-muted-foreground mb-2">Subject: ${subject}</p>

          <div class="mb-2">
            <div class="flex items-center justify-between text-sm mb-1">
              <span class="text-muted-foreground">Semester</span>
              <span class="font-medium">${semester}</span>
            </div>
            <div class="w-full bg-muted rounded-full h-2">
              <div class="bg-gradient-to-r from-blue-500 to-purple-600 h-2 rounded-full transition-all duration-300" 
                   style="width: ${downloads > 100 ? 100 : downloads}%"></div>
            </div>
          </div>

          <div class="flex items-center justify-between text-sm text-muted-foreground mb-4">
            <div class="flex items-center gap-1">
              <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <polyline points="12,6 12,12 16,14"/>
              </svg>
              <span>${semester}</span>
            </div>
            <div class="flex items-center gap-3">
              <div class="flex items-center gap-1">
                <svg class="w-4 h-4 text-yellow-500" viewBox="0 0 24 24" fill="currentColor">
                  <polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26"/>
                </svg>
                <span>${rating}</span>
              </div>
              <div class="flex items-center gap-1">
                <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                  <circle cx="12" cy="7" r="4"/>
                </svg>
                <span>${downloads}</span>
              </div>
            </div>
          </div>

          <button onclick="window.open('${fileUrl}', '_blank')" 
                  class="w-full px-4 py-2 bg-transparent border border-border rounded-lg hover:bg-accent transition-colors">
            Open File
          </button>
        </div>
      </div>
    `;
  });
}
 
</script>


</body>
</html>
