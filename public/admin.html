<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Admin Panel - Manage Requests</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

* { margin:0; padding:0; box-sizing:border-box; }
body {
    font-family: 'Inter', sans-serif;
    min-height:100vh;
    background: linear-gradient(135deg,#667eea 0%,#764ba2 100%);
    color:#fff;
    padding:2rem 1rem;
}

.container { max-width:1200px; margin:0 auto; position:relative; z-index:1; }
h1 { text-align:center; font-size:2.5rem; margin-bottom:0.5rem; font-weight:700; }
h1::before { content:'ðŸ“‹'; display:block; font-size:3rem; margin-bottom:0.5rem; }

.subtitle { text-align:center; color:rgba(255,255,255,0.8); margin-bottom:2rem; font-size:1.1rem; font-weight:500; }

.search-container { max-width:450px; margin:0 auto 2rem; position:relative; }
.search-input {
    width:100%;
    padding:1rem 1.25rem 1rem 3rem;
    border:none;
    border-radius:1rem;
    font-size:1rem;
    background: rgba(255,255,255,0.2);
    backdrop-filter:blur(20px);
    border:1px solid rgba(255,255,255,0.3);
    color:white;
    font-weight:500;
    transition: all 0.3s ease;
}
.search-input::placeholder { color: rgba(255,255,255,0.7); }
.search-input:focus { outline:none; background:rgba(255,255,255,0.25); border-color:rgba(255,255,255,0.5); box-shadow:0 8px 32px rgba(0,0,0,0.1); transform:translateY(-2px); }
.search-icon { position:absolute; left:1rem; top:50%; transform:translateY(-50%); color:rgba(255,255,255,0.8); width:1.2rem; height:1.2rem; }

.grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(350px,1fr)); gap:2rem; }
.card {
    background: rgba(255,255,255,0.15);
    backdrop-filter:blur(20px);
    border:1px solid rgba(255,255,255,0.2);
    border-radius:1.25rem;
    padding:1.75rem;
    transition: all 0.3s ease;
    position: relative;
}
.card:hover { transform:translateY(-8px); box-shadow:0 20px 40px rgba(0,0,0,0.15); background: rgba(255,255,255,0.2); border-color: rgba(255,255,255,0.3); }
.card-title { font-size:1.25rem; font-weight:600; margin-bottom:0.75rem; }
.card-meta { display:flex; gap:1rem; font-size:0.875rem; color:rgba(255,255,255,0.8); font-weight:500; }
.separator { color:rgba(255,255,255,0.5); font-weight:bold; }

.detail-item { margin-bottom:0.875rem; font-size:0.9rem; }
.detail-label { color:rgba(255,255,255,0.7); margin-right:0.5rem; font-weight:400; }

.notes { background:rgba(255,255,255,0.1); padding:1rem; border-radius:0.75rem; font-size:0.875rem; color:rgba(255,255,255,0.95); margin-top:0.75rem; border:1px solid rgba(255,255,255,0.15); }

.card-footer { display:flex; justify-content:space-between; align-items:center; padding-top:1.25rem; border-top:1px solid rgba(255,255,255,0.2); }
.date-info { font-size:0.8rem; color:rgba(255,255,255,0.7); font-weight:500; }
.actions { display:flex; gap:0.75rem; }

.btn { padding:0.5rem 1rem; border-radius:0.5rem; font-size:0.875rem; font-weight:500; cursor:pointer; display:flex; align-items:center; gap:0.375rem; border:1px solid; backdrop-filter:blur(10px); position:relative; overflow:hidden; transition: all 0.3s ease; }
.btn-outline { background: rgba(255,255,255,0.15); border-color: rgba(255,255,255,0.3); color:white; }
.btn-outline:hover { background: rgba(255,255,255,0.25); border-color: rgba(255,255,255,0.4); transform: translateY(-2px); box-shadow:0 5px 15px rgba(0,0,0,0.2); }
.btn-delete { background: rgba(239,68,68,0.2); color:#fca5a5; border-color: rgba(239,68,68,0.3); }
.btn-delete:hover { background: rgba(239,68,68,0.3); border-color: rgba(239,68,68,0.5); color:white; transform: translateY(-2px); box-shadow:0 5px 15px rgba(239,68,68,0.3); }

.toast {
    position: fixed; bottom:1.5rem; right:1.5rem;
    background: rgba(255,255,255,0.15);
    backdrop-filter:blur(20px);
    border:1px solid rgba(255,255,255,0.2);
    border-left:4px solid #10b981;
    border-radius:0.75rem;
    padding:1.25rem 1.5rem;
    color:white;
    font-weight:500;
    min-width:200px;
    transform: translateX(120%);
    transition: all 0.4s ease;
    z-index:1000;
}
.toast.show { transform:translateX(0); }
.toast.error { border-left-color:#ef4444; }

@media(max-width:768px) {
    .grid { grid-template-columns:1fr; gap:1.5rem; }
    .card-footer { flex-direction:column; gap:1rem; align-items:stretch; }
    .actions { justify-content:center; }
}
</style>
</head>
<body>

<div class="container">
    <h1>Student Requests</h1>
    <p class="subtitle" id="subtitle">Loading requests...</p>

    <div class="search-container">
        <svg class="search-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
        </svg>
        <input type="text" id="searchInput" class="search-input" placeholder="Search requests...">
    </div>

    <div class="grid" id="requestsGrid">
        <!-- Loading skeletons -->
        <div class="card"><div style="height:80px;background:rgba(255,255,255,0.2);border-radius:0.5rem;animation:pulse 1.5s infinite;"></div></div>
        <div class="card"><div style="height:80px;background:rgba(255,255,255,0.2);border-radius:0.5rem;animation:pulse 1.5s infinite;"></div></div>
        <div class="card"><div style="height:80px;background:rgba(255,255,255,0.2);border-radius:0.5rem;animation:pulse 1.5s infinite;"></div></div>
    </div>
</div>

<div class="toast" id="toast"></div>

<script>
const requestsGrid = document.getElementById('requestsGrid');
const searchInput = document.getElementById('searchInput');
const subtitle = document.getElementById('subtitle');
const toast = document.getElementById('toast');
let allRequests = [];
let filteredRequests = [];

function escapeHtml(text) { const div=document.createElement('div'); div.textContent=text||''; return div.innerHTML; }

async function fetchRequests() {
    try {
        const res = await fetch('/api/requests');
        if (!res.ok) throw new Error('Failed to fetch requests');
        const data = await res.json();
        allRequests = data.requests || [];
        filteredRequests = [...allRequests];
        updateSubtitle();
        renderRequests();
        setupSearch();
    } catch(e) { showToast(e.message,'error'); }
}

function updateSubtitle() {
    subtitle.textContent = filteredRequests.length === 0 ? "No requests found." : `Total requests: ${filteredRequests.length}`;
}

function renderRequests() {
    requestsGrid.innerHTML = '';
    filteredRequests.slice().reverse().forEach(req=>{
        const card = document.createElement('div');
        card.className='card';
        card.innerHTML = `
            <div class="card-title">${escapeHtml(req.topic || 'No topic')}</div>
            <div class="card-meta">
                <span>${escapeHtml(req.course||'')}</span>
                <span class="separator">|</span>
                <span>${escapeHtml(req.program||'')}</span>
                <span class="separator">|</span>
                <span>${escapeHtml(req.semester||'')}</span>
            </div>
            <div class="notes">${escapeHtml(req.notes || 'No notes')}</div>
            <div class="card-footer">
                <div class="date-info">${new Date(req.created_at).toLocaleString()}</div>
                <div class="actions">
                    <button class="btn btn-outline copy-btn">ðŸ“‹ Copy</button>
                    <button class="btn btn-delete delete-btn">ðŸ—‘ Delete</button>
                </div>
            </div>
        `;

        // Copy
        card.querySelector('.copy-btn').addEventListener('click', e=>{
            e.stopPropagation();
            const text = `Topic: ${req.topic}\nCourse: ${req.course}\nProgram: ${req.program}\nSemester: ${req.semester}\nNotes: ${req.notes||'N/A'}\nEmail: ${req.email||'N/A'}`;
            navigator.clipboard.writeText(text);
            showToast('Copied to clipboard!', 'success');
        });

        // Delete
        card.querySelector('.delete-btn').addEventListener('click', async e=>{
            e.stopPropagation();
            if(!confirm('Delete this request?')) return;
            try{
                const res = await fetch(`/api/requests/${req.id}`,{method:'DELETE'});
                if(!res.ok) throw new Error('Failed to delete');
                filteredRequests = filteredRequests.filter(r=>r.id!==req.id);
                allRequests = allRequests.filter(r=>r.id!==req.id);
                card.remove();
                updateSubtitle();
                showToast('Request deleted','success');
            } catch(err){ showToast(err.message,'error'); }
        });

        requestsGrid.appendChild(card);
    });
}

function setupSearch(){
    searchInput.addEventListener('input',()=>{
        const q = searchInput.value.toLowerCase();
        filteredRequests = allRequests.filter(r=>JSON.stringify(r).toLowerCase().includes(q));
        updateSubtitle();
        renderRequests();
    });
}

function showToast(msg,type='success'){
    toast.textContent=msg;
    toast.className=`toast show ${type==='error'?'error':''}`;
    setTimeout(()=>{ toast.className='toast'; },3000);
}

fetchRequests();
</script>

</body>
</html>
